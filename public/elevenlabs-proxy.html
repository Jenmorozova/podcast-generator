<!DOCTYPE html>
<html>
<head>
    <title>ElevenLabs Proxy</title>
</head>
<body>
    <script>
        // Получаем параметры из URL
        const urlParams = new URLSearchParams(window.location.search);
        const voiceId = urlParams.get('voiceId');
        const text = urlParams.get('text');
        const apiKey = urlParams.get('apiKey');
        
        if (voiceId && text && apiKey) {
            // Делаем запрос к ElevenLabs API
            fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'Content-Type': 'application/json',
                    'xi-api-key': apiKey
                },
                body: JSON.stringify({
                    text: decodeURIComponent(text),
                    model_id: 'eleven_multilingual_v2',
                    voice_settings: {
                        stability: 0.5,
                        similarity_boost: 0.5,
                        style: 0.0,
                        use_speaker_boost: true
                    }
                })
            })
            .then(response => response.blob())
            .then(blob => {
                const audioUrl = URL.createObjectURL(blob);
                const audio = new Audio(audioUrl);
                audio.play();
                
                // Уведомляем родительское окно о завершении
                window.parent.postMessage({ type: 'elevenlabs_audio_ready', audioUrl }, '*');
            })
            .catch(error => {
                console.error('ElevenLabs error:', error);
                window.parent.postMessage({ type: 'elevenlabs_error', error: error.message }, '*');
            });
        }
    </script>
</body>
</html>
